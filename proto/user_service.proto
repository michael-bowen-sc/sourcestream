syntax = "proto3";

package backend;

option go_package = "sourcestream/backend/pb";

// User management service
service UserService {
  rpc RegisterContributor (RegisterContributorRequest) returns (RegisterContributorResponse);
  rpc GetContributor (GetContributorRequest) returns (GetContributorResponse);
  rpc GetUserProfile (GetUserProfileRequest) returns (GetUserProfileResponse);
}

// Project management service
service ProjectService {
  rpc GetAuthoredProjects (GetAuthoredProjectsRequest) returns (GetAuthoredProjectsResponse);
  rpc GetContributedProjects (GetContributedProjectsRequest) returns (GetContributedProjectsResponse);
  rpc GetApprovedProjects (GetApprovedProjectsRequest) returns (GetApprovedProjectsResponse);
  rpc CreateProject (CreateProjectRequest) returns (CreateProjectResponse);
  rpc GetApprovedProjectsList (GetApprovedProjectsListRequest) returns (GetApprovedProjectsListResponse);
}

// Request management service
service RequestService {
  rpc SubmitProjectRequest (SubmitProjectRequestRequest) returns (SubmitProjectRequestResponse);
  rpc SubmitPullRequestApproval (SubmitPullRequestApprovalRequest) returns (SubmitPullRequestApprovalResponse);
  rpc SubmitAccessRequest (SubmitAccessRequestRequest) returns (SubmitAccessRequestResponse);
  rpc SubmitContributionPermissionRequest (SubmitContributionPermissionRequestRequest) returns (SubmitContributionPermissionRequestResponse);
  rpc GetRequests (GetRequestsRequest) returns (GetRequestsResponse);
}

// Common types
message Project {
  string id = 1;
  string name = 2;
  string description = 3;
  string status = 4; // active, pending, approved, archived
  string last_activity = 5;
  string url = 6;
  string license = 7;
  string owner_id = 8;
}

message ApprovedProject {
  string id = 1;
  string name = 2;
  string description = 3;
  string repository_url = 4;
  string license = 5;
  string contribution_type = 6; // CLA, CCLA, DCO
  string maintainer_contact = 7;
  string approval_date = 8;
  bool is_active = 9;
  repeated string allowed_contribution_types = 10; // bug-fix, feature, documentation, etc.
}

message User {
  string corporate_id = 1;
  string github_username = 2;
  string name = 3;
  string department = 4;
  string email = 5;
  string role = 6; // user, ospo_admin, admin
}

message Request {
  string id = 1;
  string type = 2; // project, pullrequest, access
  string title = 3;
  string status = 4; // pending, approved, rejected
  string requester_id = 5;
  string created_at = 6;
  string project_name = 7;
  string project_url = 8;
  string license = 9;
  string role = 10;
}

// User Service Messages
message RegisterContributorRequest {
  string corporate_id = 1;
  string github_username = 2;
}

message RegisterContributorResponse {
  string message = 1;
}

message GetContributorRequest {
  string corporate_id = 1;
}

message GetContributorResponse {
  string corporate_id = 1;
  string github_username = 2;
  repeated string approved_projects = 3;
}

message GetUserProfileRequest {
  string corporate_id = 1;
}

message GetUserProfileResponse {
  User user = 1;
}

// Project Service Messages
message GetAuthoredProjectsRequest {
  string user_id = 1;
  int32 page = 2;
  int32 limit = 3;
}

message GetAuthoredProjectsResponse {
  repeated Project projects = 1;
  int32 total = 2;
}

message GetContributedProjectsRequest {
  string user_id = 1;
  int32 page = 2;
  int32 limit = 3;
}

message GetContributedProjectsResponse {
  repeated Project projects = 1;
  int32 total = 2;
}

message GetApprovedProjectsRequest {
  string user_id = 1;
  int32 page = 2;
  int32 limit = 3;
}

message GetApprovedProjectsResponse {
  repeated Project projects = 1;
  int32 total = 2;
}

message CreateProjectRequest {
  string name = 1;
  string description = 2;
  string url = 3;
  string license = 4;
  string owner_id = 5;
}

message CreateProjectResponse {
  Project project = 1;
  string message = 2;
}

// Request Service Messages
message SubmitProjectRequestRequest {
  string title = 1;
  string project_url = 2;
  string license = 3;
  string requester_id = 4;
}

message SubmitProjectRequestResponse {
  string request_id = 1;
  string message = 2;
}

message SubmitPullRequestApprovalRequest {
  string title = 1;
  string project_name = 2;
  string pr_url = 3;
  string requester_id = 4;
}

message SubmitPullRequestApprovalResponse {
  string request_id = 1;
  string message = 2;
}

message SubmitAccessRequestRequest {
  string title = 1;
  string project_name = 2;
  string role = 3;
  string requester_id = 4;
}

message SubmitAccessRequestResponse {
  string request_id = 1;
  string message = 2;
}

message GetRequestsRequest {
  string user_id = 1;
  string status = 2; // optional filter
  int32 page = 3;
  int32 limit = 4;
}

message GetRequestsResponse {
  repeated Request requests = 1;
  int32 total = 2;
}

// New messages for approved projects list
message GetApprovedProjectsListRequest {
  bool active_only = 1;
}

message GetApprovedProjectsListResponse {
  repeated ApprovedProject projects = 1;
}

// New messages for contribution permission requests
message SubmitContributionPermissionRequestRequest {
  string title = 1;
  string approved_project_id = 2;
  string business_justification = 3;
  string requester_id = 4;
}

message SubmitContributionPermissionRequestResponse {
  string request_id = 1;
  string message = 2;
}
